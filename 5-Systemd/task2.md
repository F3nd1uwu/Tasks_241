# Пишем юниты

1. Создайте скрипт который создаёт папку заполняет её файлами ( имена 1-4 ) и записывает в них информацию
о текущей дате, версии ядра, имени компьютера и списе всех файлов в домашнем каталоге пользователя от которого выполняется скрипт( не забудьте сдлеать проверку на существование файлов и папок)
2. Создайте юнит который будет вызывать этот скрипт при запуске. Проверьте
3. Создайте таймер который будет вызывать выполнение одноимённого systemd юнита каждые 5 минут.
4. От какого пользователя вызыаются юниты поумолчанию?
5. Создайте пользователя от имени которого будет выполняться ваш скрипт.
6. Дополните юнит информацией о пользователе от которого должен выплняться скрипт.
7. Дополните ваш скрипт так, что бы он независимо от местоположения всега выполнялся в домашней папке того кто его вызывает.

Ответ:

1. Создайте скрипт который создаёт папку заполняет её файлами ( имена 1-4 ) и записывает в них информацию
о текущей дате, версии ядра, имени компьютера и списе всех файлов в домашнем каталоге пользователя от которого выполняется скрипт( не забудьте сдлеать проверку на существование файлов и папок)

#!/bin/bash

# Папка, которую нужно создать
DIR_NAME="my_folder"

# Проверка на существование папки
if [ -d "$DIR_NAME" ]; then
  echo "Папка '$DIR_NAME' уже существует."
else
  # Создание папки
  mkdir "$DIR_NAME"
  echo "Папка '$DIR_NAME' успешно создана."
fi

# Информация для записи
DATE=$(date)
KERNEL_VERSION=$(uname -r)
HOSTNAME=$(hostname)
HOME_FILES=$(ls $HOME)

# Запись информации в файлы
for i in {1..4}; do
  FILE="$DIR_NAME/$i"
  
  # Проверка на существование файла
  if [ -e "$FILE" ]; then
    echo "Файл '$FILE' уже существует."
  else
    # Запись информации в файл
    {
      echo "Дата: $DATE"
      echo "Версия ядра: $KERNEL_VERSION"
      echo "Имя компьютера: $HOSTNAME"
      echo "Список файлов в домашнем каталоге:"
      echo "$HOME_FILES"
    } > "$FILE"
    echo "Информация записана в файл '$FILE'."
  fi
done

2. Создайте юнит который будет вызывать этот скрипт при запуске. Проверьте
sudo vi /etc/systemd/system/task.service

В нем записать:
[Unit]
   Description=мой системд юнит

   [Service]
   Type=oneshot
   ExecStart=/usr/local/bin/task.sh
   RemainAfterExit=yes

   [Install]
   WantedBy=multi-user.target

Запускаем:
sudo systemctl enable task.service

Порверка:
systemctl status task.service

3. Создайте таймер который будет вызывать выполнение одноимённого systemd юнита каждые 5 минут.
sudo vi /etc/systemd/system/task.timer

В него записать:
[Unit]
   Description=Таймер какой то...

   [Timer]
   OnActiveSec=5min
   OnUnitActiveSec=5min
   Unit=task.service

   [Install]
   WantedBy=timers.target

Запускаем:
sudo systemctl daemon-reload
sudo systemctl enable --now task.timer

Проверка:
systemctl status task.timer

4. От какого пользователя вызыаются юниты по умолчанию?
root

5. Создайте пользователя от имени которого будет выполняться ваш скрипт.
sudo adduser systemdchel

6. Дополните юнит информацией о пользователе от которого должен выплняться скрипт.
В отделе [Service] запишем User=systemdchel

7. Дополните ваш скрипт так, что бы он независимо от местоположения всего выполнялся в домашней папке того кто его вызывает.
В начало скрипта добавить:

USER_HOME=$(eval echo ~$USER)
cd "$USER_HOME" || exit

